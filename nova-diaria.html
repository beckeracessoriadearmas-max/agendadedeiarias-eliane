<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Nova Di√°ria</title>
    <link rel="stylesheet" href="estilo.css">
	<script>
if (localStorage.getItem("logado") !== "true") {
    window.location.href = "login.html";
}
</script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff69b4">

</head>
<body>

<h1>Nova Di√°ria</h1>

<form>

    <label>Data:</label><br>
    <input type="date" id="data"><br><br>

    <label>Hor√°rio:</label><br>
    <input type="time" id="horario"><br><br>

    <label>Cliente:</label><br>
    <input type="text" id="cliente"><br><br>

    <label>Endere√ßo:</label><br>
    <input type="text" id="endereco"><br><br>

    <label>Valor da di√°ria:</label><br>
    <input type="number" id="valor"><br><br>

    <button type="button" onclick="salvarDiaria()">Salvar</button>

    <a href="dashboard.html">
        <button type="button">Voltar</button>
    </a>

    <button type="button" onclick="logout()">Sair</button>

</form>

<script>
// ================= LOGOUT =================
function logout() {
    localStorage.removeItem("logado");
    window.location.href = "login.html";
}

// ============ PERMISS√ÉO NOTIFICA√á√ÉO ============
if ("Notification" in window) {
    Notification.requestPermission();
}

// ============ AGENDAR NOTIFICA√á√ÉO ============
function agendarNotificacao(mensagem, dataHora) {
    const agora = new Date().getTime();
    const horario = new Date(dataHora).getTime();
    const tempo = horario - agora;

    if (tempo > 0) {
        setTimeout(() => {
            new Notification("Agenda da Elaine üíï", {
                body: mensagem
            });
        }, tempo);
    }
}

// ============ SALVAR DI√ÅRIA ============
function salvarDiaria() {
    let data = document.getElementById("data").value;
    let horario = document.getElementById("horario").value;
    let cliente = document.getElementById("cliente").value;
    let endereco = document.getElementById("endereco").value;
    let valor = document.getElementById("valor").value;

    if (!data || !horario || !cliente || !valor) {
        alert("Preencha os campos obrigat√≥rios!");
        return;
    }

    let diarias = JSON.parse(localStorage.getItem("diarias")) || [];

    let conflito = diarias.some(d =>
        d.data === data && d.horario === horario
    );

    if (conflito) {
        alert("‚ö†Ô∏è J√° existe uma di√°ria nesse hor√°rio!");
        return;
    }

    diarias.push({ data, horario, cliente, endereco, valor });
    localStorage.setItem("diarias", JSON.stringify(diarias));

    // üîî Agendar notifica√ß√£o
    const dataHora = `${data}T${horario}`;
    agendarNotificacao(
        `Hora de ir para a di√°ria em ${endereco}`,
        dataHora
    );

    alert("‚úÖ Di√°ria salva com notifica√ß√£o!");
}
</script>

</body>
</html>
